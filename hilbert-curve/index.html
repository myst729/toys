<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
  <title>Hilbert Curve</title>
  <link rel="stylesheet" href="bootstrap.min.css" />
</head>
<body>
  <section class="container mt-3">
    <div class="d-flex">
      <section class="me-4">
        <h1 class="mb-4">Hilbert Curve</h1>
        <div class="mb-3">
          <label for="imageSize" class="form-label">Image Size:</label>
          <span></span>
          <input type="range" class="form-range" min="200" max="800" step="100" value="400" id="imageSize" />
        </div>
        <div class="mb-3">
          <label for="iterationCount" class="form-label">Iteration Count:</label>
          <span></span>
          <input type="range" class="form-range" min="1" max="9" step="1" value="5" id="iterationCount" />
        </div>
        <div class="mb-3">
          <label for="strokeWidth" class="form-label">Stroke Width:</label>
          <span></span>
          <input type="range" class="form-range" min="0.1" max="9" step="0.1" value="1" id="strokeWidth" />
        </div>
      </section>
      <section>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400" width="400" height="400">
          <path id="path" fill="none" stroke="black" stroke-width="1" stroke-linecap="square" />
        </svg>
      </section>
    </div>
  </section>
  <script>
    ((doc, win, undef) => {
      const imageSizeInput = doc.getElementById('imageSize')
      const iterationCountInput = doc.getElementById('iterationCount')
      const strokeWidthInput = doc.getElementById('strokeWidth')
      const path = doc.getElementById('path')

      const getPoints = (depth, sx, sy, dx, dy, ccw) => {
        // [sx, sy]: start point
        // [cx, cy]: center point
        // [dx, dy]: diagonal point
        const result = []
        const cx = (sx + dx) / 2
        const cy = (sy + dy) / 2
        if (depth > 1) {
          if (ccw) {
            return [
              ...getPoints(depth - 1, sx, sy, cx, cy, !ccw),
              ...getPoints(depth - 1, sx, cy, cx, dy, ccw),
              ...getPoints(depth - 1, cx, cy, dx, dy, ccw),
              ...getPoints(depth - 1, dx, cy, cx, sy, !ccw),
            ]
          } else {
            return [
              ...getPoints(depth - 1, sx, sy, cx, cy, !ccw),
              ...getPoints(depth - 1, cx, sy, dx, cy, ccw),
              ...getPoints(depth - 1, cx, cy, dx, dy, ccw),
              ...getPoints(depth - 1, cx, dy, sx, cy, !ccw),
            ]
          }
        } else {
          if (ccw) {
            return [
              [(sx + cx) / 2, (sy + cy) / 2],
              [(sx + cx) / 2, (cy + dy) / 2],
              [(cx + dx) / 2, (cy + dy) / 2],
              [(dx + cx) / 2, (cy + sy) / 2],
            ]
          } else {
            return [
              [(sx + cx) / 2, (sy + cy) / 2],
              [(cx + dx) / 2, (sy + cy) / 2],
              [(cx + dx) / 2, (cy + dy) / 2],
              [(cx + sx) / 2, (dy + cy) / 2],
            ]
          }
        }
      }

      const generateD = (depth, size) => {
        const points = getPoints(depth, 0, 0, size, size, 1)
        return `M ${points.map(p => p.join(',')).join(' L ')}`
      }

      const updateImage = () => {
        const svg = path.parentElement
        const depth = +iterationCountInput.value
        const size = +imageSizeInput.value
        const strokeWidth = +strokeWidthInput.value

        imageSizeInput.previousElementSibling.textContent = size
        iterationCountInput.previousElementSibling.textContent = depth
        strokeWidthInput.previousElementSibling.textContent = +strokeWidth

        svg.setAttribute('width', size)
        svg.setAttribute('height', size)
        svg.setAttribute('viewBox', `0 0 ${size} ${size}`)
        path.setAttribute('stroke-width', strokeWidth)
        path.setAttribute('d', generateD(depth, size))
      }

      const init = () => {
        imageSizeInput.addEventListener('input', updateImage)
        iterationCountInput.addEventListener('input', updateImage)
        strokeWidthInput.addEventListener('input', updateImage)
        updateImage()
      }

      init()
    })(document, window)
</script>
</body>
