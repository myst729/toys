<title>Neon Matrix Effects</title>

<style>
*, *:before, *:after {
  box-sizing: border-box;
}
body {
  font-family: sans-serif;
  margin: 30px;
}
section {
  width: 190px;
  height: 210px;
  display: inline-block;
  position: relative;
}
section:before {
  content: attr(data-mode);
  font-weight: bold;
  text-transform: uppercase;
}
p {
  width: 22px;
  height: 22px;
  border: 1px solid #000;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: rgba(0, 0, 0, 1);
  position: absolute;
}
</style>

<h1>Neon Matrix Effects</h1>
<section data-mode="zigzag">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="scanline">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="swirl-in">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="swirl-out">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="circle-in">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="circle-out">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="square-in">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="square-out">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>

<script>
((doc, win, undef) => {
  const state = { frame: 0 }
  const faces = doc.querySelectorAll('section')

  const delay = (ms) => {
    return new Promise(resolve => {
      setTimeout(resolve, ms)
    })
  }

  const swirl = (row, col) => {
    /*
    ┌────┬────┬────┬────┬────┬────┬────┬────┐
    │    │                                  │
    ├    └────┐    x    x    x    x    ┌────┤
    │         │          TOP           │    │
    ├    x    └────┐    x    x    ┌────┘    ┤
    │              │              │         │
    ├    x    x    └────┐    ┌────┘    x    ┤
    │     LEFT          │    │              │
    ├    x    x    ┌────┼────┘    x    x    ┤
    │              │    │         RIGHT     │
    ├    x    ┌────┘    └────┐    x    x    ┤
    │         │              │              │
    ├    ┌────┘    x    x    └────┐    x    ┤
    │    │         BOTTOM         │         │
    ├────┘    x    x    x    x    └────┐    ┤
    │                                  │    │
    └────┴────┴────┴────┴────┴────┴────┴────┘
    */
    if (row < 4 && row <= col && col < 7 - row) {
      // TOP: (8 * 2 * row) + (8 - 2 * row) * (2 * row) - row + col
      return 31 * row - 4 * row * row + col
    }
    if (col >= 4 && col > row && row >= 7 - col) {
      // RIGHT: (8 * 2 * (7 - col)) + (8 - 2 * (7 - col)) * (2 * (7 - col) + 1) - (8 - col) + row
      return 27 * col - 4 * col * col + row + 14
    }
    if (row >= 4 && row >= col && col > 7 - row) {
      // BOTTOM: (8 * (2 * (7 - row) + 1)) + (8 - (2 * (7 - row) + 1)) * (2 * (7 - row) + 1) + (7 - col) - (8 - row)
      return 29 * row - 4 * row * row - col + 14
    }
    if (col < 4 && col < row && row <= 7 - col) {
      // LEFT: (8 * (2 * (col + 1))) + (8 - (2 * (col + 1))) * (2 * col + 1) + (7 - row) - (col + 1)
      return 25 * col - 4 * col * col - row + 28
    }
  }

  const effects = {
    /*
    ┌────┬────┬────┬────┬────┬────┬────┬────┐
    │  0 │  1 │  2 │  3 │  4 │  5 │  6 │  7 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 15 │ 14 │ 13 │ 12 │ 11 │ 10 │  9 │  8 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 16 │ 17 │ 18 │ 19 │ 20 │ 21 │ 22 │ 23 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 31 │ 30 │ 29 │ 28 │ 27 │ 26 │ 25 │ 24 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 32 │ 33 │ 34 │ 35 │ 36 │ 37 │ 38 │ 39 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 47 │ 46 │ 45 │ 44 │ 43 │ 42 │ 41 │ 40 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 48 │ 49 │ 50 │ 51 │ 52 │ 53 │ 54 │ 55 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 63 │ 62 │ 61 │ 60 │ 59 │ 58 │ 57 │ 56 │
    └────┴────┴────┴────┴────┴────┴────┴────┘
    */
    'zigzag': (cell, row, col, hue) => {
      const i = row % 2 ? (row + 1) * 8 - col - 1 : row * 8 + col
      const diff = (state.frame - i + 64) % 64
      if (diff >= 0 && diff < 5) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    /*
    ┌────┬────┬────┬────┬────┬────┬────┬────┐
    │  0 │  1 │  2 │  3 │  4 │  5 │  6 │  7 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  8 │  9 │ 10 │ 11 │ 12 │ 13 │ 14 │ 15 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 16 │ 17 │ 18 │ 19 │ 20 │ 21 │ 22 │ 23 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 24 │ 25 │ 26 │ 27 │ 28 │ 29 │ 30 │ 31 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 32 │ 33 │ 34 │ 35 │ 36 │ 37 │ 38 │ 39 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 40 │ 41 │ 42 │ 43 │ 44 │ 45 │ 46 │ 47 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 48 │ 49 │ 50 │ 51 │ 52 │ 53 │ 54 │ 55 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 56 │ 57 │ 58 │ 59 │ 60 │ 61 │ 62 │ 63 │
    └────┴────┴────┴────┴────┴────┴────┴────┘
    */
    'scanline': (cell, row, col, hue) => {
      const i = row * 8 + col
      const diff = (state.frame - i + 64) % 64
      if (diff >= 0 && diff < 5) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    /*
    ┌────┬────┬────┬────┬────┬────┬────┬────┐
    │  0 │  1 │  2 │  3 │  4 │  5 │  6 │  7 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 27 │ 28 │ 29 │ 30 │ 31 │ 32 │ 33 │  8 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 26 │ 47 │ 48 │ 49 │ 50 │ 51 │ 34 │  9 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 25 │ 46 │ 59 │ 60 │ 61 │ 52 │ 35 │ 10 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 24 │ 45 │ 58 │ 63 │ 62 │ 53 │ 36 │ 11 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 23 │ 44 │ 57 │ 56 │ 55 │ 54 │ 37 │ 12 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 22 │ 43 │ 42 │ 41 │ 40 │ 39 │ 38 │ 13 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 21 │ 20 │ 19 │ 18 │ 17 │ 16 │ 15 │ 14 │
    └────┴────┴────┴────┴────┴────┴────┴────┘
    */
    'swirl-in': (cell, row, col, hue) => {
      const i = swirl(row, col)
      const diff = (state.frame - i + 64) % 64
      if (diff >= 0 && diff < 5) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    /*
    ┌────┬────┬────┬────┬────┬────┬────┬────┐
    │ 63 │ 62 │ 61 │ 60 │ 59 │ 58 │ 57 │ 56 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 36 │ 35 │ 34 │ 33 │ 32 │ 31 │ 30 │ 55 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 37 │ 16 │ 15 │ 14 │ 13 │ 12 │ 29 │ 54 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 38 │ 17 │  4 │  3 │  2 │ 11 │ 28 │ 53 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 39 │ 18 │  5 │  0 │  1 │ 10 │ 27 │ 52 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 40 │ 19 │  6 │  7 │  8 │  9 │ 26 │ 51 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 41 │ 20 │ 21 │ 22 │ 23 │ 24 │ 25 │ 50 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │ 42 │ 43 │ 44 │ 45 │ 46 │ 47 │ 48 │ 49 │
    └────┴────┴────┴────┴────┴────┴────┴────┘
    */
    'swirl-out': (cell, row, col, hue) => {
      const i = 63 - swirl(row, col)
      const diff = (state.frame - i + 64) % 64
      if (diff >= 0 && diff < 5) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    /*
    ┌────┬────┬────┬────┬────┬────┬────┬────┐
    │  0 │  1 │  2 │  3 │  3 │  2 │  1 │  0 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  1 │  2 │  3 │  4 │  4 │  3 │  2 │  1 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  2 │  3 │  4 │  5 │  5 │  4 │  3 │  2 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  3 │  4 │  5 │  6 │  6 │  5 │  4 │  3 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  3 │  4 │  5 │  6 │  6 │  5 │  4 │  3 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  2 │  3 │  4 │  5 │  5 │  4 │  3 │  2 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  1 │  2 │  3 │  4 │  4 │  3 │  2 │  1 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  0 │  1 │  2 │  3 │  3 │  2 │  1 │  0 │
    └────┴────┴────┴────┴────┴────┴────┴────┘
    */
    'circle-in': (cell, row, col, hue) => {
      const i = Math.min(row, 7 - row) + Math.min(col, 7 - col)
      const diff = (Math.floor(state.frame / 4) % 4 - i + 4) % 4
      if (diff >= 0 && diff < 3) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    /*
    ┌────┬────┬────┬────┬────┬────┬────┬────┐
    │  6 │  5 │  4 │  3 │  3 │  4 │  5 │  6 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  5 │  4 │  3 │  2 │  2 │  3 │  4 │  5 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  4 │  3 │  2 │  1 │  1 │  2 │  3 │  4 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  3 │  2 │  1 │  0 │  0 │  1 │  2 │  3 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  3 │  2 │  1 │  0 │  0 │  1 │  2 │  3 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  4 │  3 │  2 │  1 │  1 │  2 │  3 │  4 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  5 │  4 │  3 │  2 │  2 │  3 │  4 │  5 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  6 │  5 │  4 │  3 │  3 │  4 │  5 │  6 │
    └────┴────┴────┴────┴────┴────┴────┴────┘
    */
    'circle-out': (cell, row, col, hue) => {
      const i = Math.max(row - 4, 3 - row) + Math.max(col - 4, 3 - col)
      const diff = (Math.floor(state.frame / 4) % 4 - i + 4) % 4
      if (diff >= 0 && diff < 3) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    /*
    ┌────┬────┬────┬────┬────┬────┬────┬────┐
    │  0 │  0 │  0 │  0 │  0 │  0 │  0 │  0 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  0 │  1 │  1 │  1 │  1 │  1 │  1 │  0 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  0 │  1 │  2 │  2 │  2 │  2 │  1 │  0 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  0 │  1 │  2 │  3 │  3 │  2 │  1 │  0 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  0 │  1 │  2 │  3 │  3 │  2 │  1 │  0 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  0 │  1 │  2 │  2 │  2 │  2 │  1 │  0 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  0 │  1 │  1 │  1 │  1 │  1 │  1 │  0 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  0 │  0 │  0 │  0 │  0 │  0 │  0 │  0 │
    └────┴────┴────┴────┴────┴────┴────┴────┘
    */
    'square-in': (cell, row, col, hue) => {
      const i = Math.min(row, 7 - row, col, 7 - col)
      const diff = (Math.floor(state.frame / 4) % 4 - i + 4) % 4
      if (diff >= 0 && diff < 3) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    /*
    ┌────┬────┬────┬────┬────┬────┬────┬────┐
    │  3 │  3 │  3 │  3 │  3 │  3 │  3 │  3 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  3 │  2 │  2 │  2 │  2 │  2 │  2 │  3 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  3 │  2 │  1 │  1 │  1 │  1 │  2 │  3 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  3 │  2 │  1 │  0 │  0 │  1 │  2 │  3 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  3 │  2 │  1 │  0 │  0 │  1 │  2 │  3 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  3 │  2 │  1 │  1 │  1 │  1 │  2 │  3 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  3 │  2 │  2 │  2 │  2 │  2 │  2 │  3 │
    ├────┼────┼────┼────┼────┼────┼────┼────┤
    │  3 │  3 │  3 │  3 │  3 │  3 │  3 │  3 │
    └────┴────┴────┴────┴────┴────┴────┴────┘
    */
    'square-out': (cell, row, col, hue) => {
      const i = Math.max(row - 4, 3 - row, col - 4, 3 - col)
      const diff = (Math.floor(state.frame / 4) % 4 - i + 4) % 4
      if (diff >= 0 && diff < 3) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },
  }

  const init = () => {
    faces.forEach(face => {
      const cells = face.querySelectorAll('p')
      cells.forEach((cell, i) => {
        const row = Math.floor(i / 8)
        const col = 7 - Math.abs(i % 16 - 7 - row % 2)
        cell.style.top = `${row * 21 + 32}px`
        cell.style.left = `${col * 21}px`
      })
    })
  }

  const update = (face, i) => {
    const hue = i * Math.floor(1080 / faces.length)
    const mode = face.dataset.mode
    const cells = face.querySelectorAll('p')
    cells.forEach((cell, i) => {
      const row = Math.floor(i / 8)
      const col = 7 - Math.abs(i % 16 - 7 - row % 2)
      effects[mode](cell, row, col, hue)
    })
  }

  const loop = async () => {
    faces.forEach(update)
    await delay(30)
    state.frame = (state.frame + 1) % 64
    requestAnimationFrame(loop)
  }

  init()
  loop()
})(document, window)
</script>
