<title>Neon Matrix Effects</title>

<style>
*, *:before, *:after {
  box-sizing: border-box;
}
body {
  font-family: sans-serif;
  margin: 30px;
}
section {
  width: 190px;
  height: 210px;
  display: inline-block;
  position: relative;
}
section:before {
  content: attr(data-mode);
  font-weight: bold;
  text-transform: uppercase;
}
p {
  width: 22px;
  height: 22px;
  border: 1px solid #000;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: rgba(0, 0, 0, 1);
  position: absolute;
}
</style>

<h1>Neon Matrix Effects</h1>
<section data-mode="zigzag">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="scanline">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="swirl-in">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="swirl-out">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="circle-in">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="circle-out">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="square-in">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>
<section data-mode="square-out">
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
  <p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
</section>

<script>
((doc, win, undef) => {
  const state = { frame: 0 }
  const faces = doc.querySelectorAll('section')

  const delay = (ms) => {
    return new Promise(resolve => {
      setTimeout(resolve, ms)
    })
  }

  const swirl = (row, col) => {
    if (row < 4 && row <= col && col < 7 - row) {
      // TOP: (8 * 2 * row) + (8 - 2 * row) * (2 * row) - row + col
      return 31 * row - 4 * row * row + col
    }
    if (col >= 4 && col > row && row >= 7 - col) {
      // RIGHT: (8 * 2 * (7 - col)) + (8 - 2 * (7 - col)) * (2 * (7 - col) + 1) - (8 - col) + row
      return 27 * col - 4 * col * col + row + 14
    }
    if (row >= 4 && row >= col && col > 7 - row) {
      // BOTTOM: (8 * (2 * (7 - row) + 1)) + (8 - (2 * (7 - row) + 1)) * (2 * (7 - row) + 1) + (7 - col) - (8 - row)
      return 29 * row - 4 * row * row - col + 14
    }
    if (col < 4 && col < row && row <= 7 - col) {
      // LEFT: (8 * (2 * (col + 1))) + (8 - (2 * (col + 1))) * (2 * col + 1) + (7 - row) - (col + 1)
      return 25 * col - 4 * col * col - row + 28
    }
  }

  const effects = {
    'zigzag': (cell, row, col, hue) => {
      const i = row % 2 ? (row + 1) * 8 - col - 1 : row * 8 + col
      const diff = (state.frame - i + 64) % 64
      if (diff >= 0 && diff < 5) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    'scanline': (cell, row, col, hue) => {
      const i = row * 8 + col
      const diff = (state.frame - i + 64) % 64
      if (diff >= 0 && diff < 5) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    'swirl-in': (cell, row, col, hue) => {
      const i = swirl(row, col)
      const diff = (state.frame - i + 64) % 64
      if (diff >= 0 && diff < 5) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    'swirl-out': (cell, row, col, hue) => {
      const i = 63 - swirl(row, col)
      const diff = (state.frame - i + 64) % 64
      if (diff >= 0 && diff < 5) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    'circle-in': (cell, row, col, hue) => {
      const i = Math.min(row, 7 - row) + Math.min(col, 7 - col)
      const diff = (Math.floor(state.frame / 4) % 4 - i + 4) % 4
      if (diff >= 0 && diff < 3) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    'circle-out': (cell, row, col, hue) => {
      const i = Math.max(row - 4, 3 - row) + Math.max(col - 4, 3 - col)
      const diff = (Math.floor(state.frame / 4) % 4 - i + 4) % 4
      if (diff >= 0 && diff < 3) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    'square-in': (cell, row, col, hue) => {
      const i = Math.min(row, 7 - row, col, 7 - col)
      const diff = (Math.floor(state.frame / 4) % 4 - i + 4) % 4
      if (diff >= 0 && diff < 3) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },

    'square-out': (cell, row, col, hue) => {
      const i = Math.max(row - 4, 3 - row, col - 4, 3 - col)
      const diff = (Math.floor(state.frame / 4) % 4 - i + 4) % 4
      if (diff >= 0 && diff < 3) {
        cell.style.backgroundColor = `hsla(${hue}, 100%, 50%, ${1 / (diff + 1)})`
      } else {
        cell.style.backgroundColor = 'rgba(255, 255, 255, 0)'
      }
    },
  }

  const init = () => {
    faces.forEach(face => {
      const cells = face.querySelectorAll('p')
      cells.forEach((cell, i) => {
        const row = Math.floor(i / 8)
        const col = 7 - Math.abs(i % 16 - 7 - row % 2)
        cell.style.top = `${row * 21 + 32}px`
        cell.style.left = `${col * 21}px`
      })
    })
  }

  const update = (face, i) => {
    const hue = i * Math.floor(1080 / faces.length)
    const mode = face.dataset.mode
    const cells = face.querySelectorAll('p')
    cells.forEach((cell, i) => {
      const row = Math.floor(i / 8)
      const col = 7 - Math.abs(i % 16 - 7 - row % 2)
      effects[mode](cell, row, col, hue)
    })
  }

  const loop = async () => {
    faces.forEach(update)
    await delay(30)
    state.frame = (state.frame + 1) % 64
    requestAnimationFrame(loop)
  }

  init()
  loop()
})(document, window)
</script>
