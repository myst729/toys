<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Ghost</title>
</head>

<body style="margin:0">
  <canvas style="display:block"></canvas>
  <script>
    const canvas = document.querySelector('canvas')
    const width = canvas.width = window.innerWidth
    const height = canvas.height = window.innerHeight
    const ctx = canvas.getContext('2d')
    const pos = { x: 0, y: 0 }

    const imageSrc = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAATCAYAAACk9eypAAAAAXNSR0IArs4c6QAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAhGVYSWZNTQAqAAAACAAFARIAAwAAAAEAAQAAARoABQAAAAEAAABKARsABQAAAAEAAABSASgAAwAAAAEAAgAAh2kABAAAAAEAAABaAAAAAAAAAEgAAAABAAAASAAAAAEAA6ABAAMAAAABAAEAAKACAAQAAAABAAAADKADAAQAAAABAAAAEwAAAAAChpcNAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAABqElEQVQoFY3SPUvDQBgH8BREpRHExYiDgmLFl6WC+AYmWeyLg4i7buJX8DMpOujgyxGvUYeCgzhUQUSKKLUS0+ZyptXh8Z5Ti621ekPyJHl+uftfomhaf9Ei5JyxXKfynyEA6EYcLHpwyflT958GAQ7DTABNHd8EbtDbEH2BD5QEQmi2mM8P/Iq+A0SzszEg+3sPjDnDdVEtQKQbMUidHD3xVzf6A9UDEmEm+8h9KTqTVUjT+vB53aHrCbAPiceYq1dQI1Aqv4EhMll0jzv+Y0yiRgCnLRSYyDQHVoqUXe4uKL9l+L7GXC4vkMhE6eW/AOJs9k583ORDUyXMZ8F5SVHVVnllmPNKSFagAJ5DofaqGXw/gHBYg51dIldkmknY3tguv3jOtHR4+MqAzaraJXbEhqHhcQlwGSOi5pytVQHZLN5s0WNe8HPrLYlFsO20RPHkImxsbmHdLJFI76th7Z4SeuF53hTeFLvhRCJRCTKZKxgdnRDbW+iozFJbBMw14/ElwGYc0egMBMFzT21f5Rog33Z7dX02GBm7WV5ZfT5Nn5bE3zuCDe9UxdTpNvK+5AAAAABJRU5ErkJggg=='
    const image = new Image
    image.src = imageSrc
    const randomDelay = false
    const minDelay = 5
    const maxDelay = 50
    const lifeSpan = 40
    const getDelay = () => Math.floor(Math.random() * (maxDelay - minDelay + 1)) + minDelay
    let lastTimeParticleAdded = Date.now()
    let interval = getDelay()
    const particles = []

    function update() {
      particles.forEach((p, i) => {
        p.lifeSpan--
        const opacity = Math.max(p.lifeSpan / p.initialLifeSpan, 0)
        ctx.globalAlpha = opacity
        ctx.drawImage(image, p.x, p.y)
      })

      for (let i = particles.length - 1; i >= 0; i--) {
        if (particles[i].lifeSpan < 0) {
          particles.splice(i, 1)
        }
      }
    }

    function loop() {
      ctx.clearRect(0, 0, width, height)
      update()
      requestAnimationFrame(loop)
    }

    canvas.addEventListener('mousemove', ({ clientX, clientY }) => {
      if (randomDelay) {
        if (lastTimeParticleAdded + interval > Date.now()) return
        lastTimeParticleAdded = Date.now()
        interval = getDelay()
      }

      pos.x = clientX
      pos.y = clientY
      particles.push({ x: clientX, y: clientY, lifeSpan, initialLifeSpan: lifeSpan })
    })

    loop()
  </script>
</body>

</html>
